{% extends "base_layout.html" %}

{% block title %}Gi·ªè h√†ng c·ªßa b·∫°n - PetShop{% endblock %}

{% block content %}
    <style>
        /* CSS d√†nh ri√™ng cho trang gi·ªè h√†ng */
        .cart-item {
            border: 1px solid var(--border-color);
            background-color: var(--bg-white);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .cart-item img {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .item-info {
            flex-grow: 1;
        }

        .item-info strong {
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .item-info p {
            margin-bottom: 5px;
        }

        .item-info input[type="number"] {
            width: 70px;
            padding: 5px;
            font-size: 1rem;
            margin-top: 5px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .item-info .item-total {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .total {
            font-weight: bold;
            font-size: 1.5rem;
            margin-top: 30px;
            text-align: right;
            color: var(--text-dark);
            border-top: 2px solid var(--border-color);
            padding-top: 15px;
        }
        
        .delete-btn {
            background-color: #dc3545; /* Bootstrap danger color */
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 20px;
            font-weight: 600;
            transition: background-color 0.3s ease-in-out;
        }

        .delete-btn:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }
    </style>

    <div class="container py-5">
        <h2 class="text-center mb-4">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>
        <div id="cartList"></div>
        <div class="total" id="totalPrice"></div>
        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-lg me-3"><i class="fas fa-arrow-left me-2"></i>Ti·∫øp t·ª•c mua s·∫Øm</a>
            <button class="btn btn-success btn-lg" onclick="alert('Ch·ª©c nƒÉng thanh to√°n ƒëang ph√°t tri·ªÉn!')"><i class="fas fa-credit-card me-2"></i>Thanh to√°n</button>
        </div>
    </div>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        const cartList = document.getElementById('cartList');
        const totalEl = document.getElementById('totalPrice');

        function renderCart() {
            cartList.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartList.innerHTML = "<p class='text-center text-muted'>Gi·ªè h√†ng tr·ªëng.</p>";
                totalEl.textContent = '';
                return;
            }

            cart.forEach((item, index) => {
                // Ensure quantity is a number, default to 1 if not
                item.quantity = parseInt(item.quantity) || 1; 

                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const div = document.createElement('div');
                div.className = 'cart-item';
                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="item-info">
                        <p><strong>${item.name}</strong></p>
                        <p>Gi√°: ${item.price.toLocaleString('vi-VN')}ƒë</p>
                        <p>
                            S·ªë l∆∞·ª£ng: 
                            <input type="number" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, this.value)">
                        </p>
                        <p class="item-total">Th√†nh ti·ªÅn: <strong>${itemTotal.toLocaleString('vi-VN')}ƒë</strong></p>
                    </div>
                    <button class="delete-btn" onclick="removeItem(${index})"><i class="fas fa-trash-alt"></i> X√≥a</button>
                `;
                cartList.appendChild(div);
            });

            totalEl.textContent = `T·ªïng c·ªông: ${total.toLocaleString('vi-VN')}ƒë`;
        }

        function updateQuantity(index, newQuantity) {
            newQuantity = parseInt(newQuantity);
            if (newQuantity >= 1) {
                cart[index].quantity = newQuantity;
                localStorage.setItem('cart', JSON.stringify(cart));
                renderCart();
                // Update header cart count as well
                if (window.parent && typeof window.parent.updateCartCount === 'function') {
                    window.parent.updateCartCount();
                } else if (typeof updateCartCount === 'function') {
                    updateCartCount();
                }
            }
        }

        function removeItem(index) {
            const removedItemName = cart[index].name; // L·∫•y t√™n s·∫£n ph·∫©m tr∆∞·ªõc khi x√≥a
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
            
            // G·ªçi h√†m c·∫≠p nh·∫≠t gi·ªè h√†ng t·ª´ base_layout n·∫øu t·ªìn t·∫°i
            if (typeof updateCartCount === 'function') { 
                updateCartCount(); 
            }

            // HI·ªÇN TH·ªä TOAST "ƒê√£ x√≥a"
            if (typeof showToast === 'function') { // G·ªçi h√†m global showToast
                showToast(`ƒê√£ x√≥a "${removedItemName}" kh·ªèi gi·ªè h√†ng.`, 'info'); // Thay ƒë·ªïi th√¥ng b√°o v√† lo·∫°i toast
            } else {
                alert(`ƒê√£ x√≥a "${removedItemName}" kh·ªèi gi·ªè h√†ng.`);
            }
        }

        document.addEventListener('DOMContentLoaded', renderCart);
    </script>
{% endblock %}